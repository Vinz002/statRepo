<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Homework: Law of Large Numbers Simulation</title>
  <meta name="description" content="Simulation illustrating the Law of Large Numbers using multiple trajectories and histogram visualization.">
  <style>
    :root{
      --bg:#f8fafc; --surface:#ffffff; --text:#0f172a; --muted:#475569;
      --primary:#0ea5e9; --primary-700:#0369a1; --accent:#22c55e;
      --border:#e2e8f0; --shadow:0 6px 24px rgba(2,6,23,.08);
      --radius:16px; --container:980px;
    }
    [data-theme="dark"]{
      color-scheme:dark;
      --bg:#0b1220; --surface:#0f172a; --text:#e5e7eb; --muted:#94a3b8;
      --primary:#38bdf8; --primary-700:#0ea5e9; --accent:#34d399;
      --border:#1f2937; --shadow:0 10px 30px rgba(0,0,0,.45);
    }
    body{background:var(--bg);color:var(--text);font:16px/1.65 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,sans-serif;margin:0;}
    .container{max-width:var(--container);margin:0 auto;padding:0 1.2rem;}
    .card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:2rem;margin:1.4rem 0;}
    h1,h2,h3{color:var(--primary-700);}
    .lead{color:var(--muted);font-size:1.05rem;}
    .btn{border:1px solid var(--border);background:var(--surface);color:var(--text);padding:.6rem 1rem;border-radius:12px;cursor:pointer;box-shadow:var(--shadow);}
    .btn.primary{background:var(--primary);color:#fff;border:none;}
    .input{padding:.6rem 1rem;border:1px solid var(--border);border-radius:10px;background:var(--surface);color:var(--text);}
    .toolbar{display:flex;align-items:center;gap:.8rem;flex-wrap:wrap;}
    canvas{width:100%;max-width:900px;height:420px;border:1px solid var(--border);border-radius:12px;background:var(--surface);}
    .note{background:rgba(34,197,94,.08);border-left:4px solid var(--accent);padding:.9rem 1rem;border-radius:8px;margin-top:1rem;}
  </style>
</head>
<body>
  <div class="container">
    <header class="card">
      <h1>Homework: Law of Large Numbers Simulation</h1>
      <p class="lead">Visualize how the empirical frequency of success converges to its theoretical probability through multiple simulation paths and final distribution histogram.</p>
    </header>

    <section class="card">
      <h2>1. Parameters</h2>
      <div class="toolbar">
        <label>Probability of success (p): <input type="number" id="p" class="input" value="0.5" min="0" max="1" step="0.05" style="width:90px;"></label>
        <label>Trials (n): <input type="number" id="n" class="input" value="1000" min="10" max="5000" step="100" style="width:90px;"></label>
        <label>Trajectories (m): <input type="number" id="m" class="input" value="20" min="1" max="100" style="width:90px;"></label>
        <button class="btn primary" id="simulateBtn">Run Simulation</button>
      </div>
    </section>

    <section class="card">
      <h2>2. Simulation Plot</h2>
      <p>Each colored line represents one trajectory of the relative frequency \( f(n) \), calculated as the proportion of successes up to trial \( n \). The histogram on the right shows the distribution of \( f(n) \) across all trajectories at the final step.</p>
      <canvas id="llnCanvas"></canvas>
      <div class="note" id="summary"></div>
    </section>

    <section class="card">
      <h2>3. Explanation</h2>
      <p>
        This experiment demonstrates the <strong>Law of Large Numbers (LLN)</strong>: as the number of trials \( n \) increases, the sample proportion of successes \( f(n) \) tends to the underlying probability \( p \).
      </p>
      <ul>
        <li>Each line shows one random experiment (trajectory).</li>
        <li>As n increases, the squiggly random paths flatten near p.</li>
        <li>The histogram on the right becomes narrower, illustrating convergence of the empirical mean.</li>
      </ul>
    </section>
  </div>

<script>
const canvas = document.getElementById('llnCanvas');
const ctx = canvas.getContext('2d');
canvas.width = 900; canvas.height = 420;

function simulateLLN(p=0.5, n=1000, m=20){
  const trials = [];
  for(let j=0;j<m;j++){
    let cumulative=0, traj=[];
    for(let i=1;i<=n;i++){
      if(Math.random() < p) cumulative++;
      traj.push(cumulative/i);
    }
    trials.push(traj);
  }
  return trials;
}

function drawLLN(trials, p) {
  const W = canvas.width, H = canvas.height;
  ctx.clearRect(0, 0, W, H);
  const n = trials[0].length, m = trials.length;

  // layout
  const leftPad = 50, topPad = 20, bottomPad = 40;
  const plotW = W - 200, plotH = H - topPad - bottomPad; // give more room to histogram
  const originX = leftPad, originY = topPad;

  ctx.save();
  ctx.translate(originX, originY);

  // === MAIN AXES (trajectories) ===
  ctx.strokeStyle = "#cbd5e1";
  ctx.lineWidth = 1;
  ctx.beginPath();
  // x axis
  ctx.moveTo(0, plotH);
  ctx.lineTo(plotW, plotH);
  // y axis
  ctx.moveTo(0, 0);
  ctx.lineTo(0, plotH);
  ctx.stroke();

  // y grid + labels for f(n)
  ctx.font = "12px system-ui";
  ctx.fillStyle = "#64748b";
  ctx.textAlign = "right";
  const yTicks = [0, 0.25, 0.5, 0.75, 1];
  ctx.strokeStyle = "rgba(148,163,184,0.35)";
  for (const t of yTicks) {
    const y = plotH - t * plotH;
    // grid
    ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(plotW, y); ctx.stroke();
    // labels
    ctx.fillText(t.toFixed(2), -8, y + 4);
  }

  // x ticks (fix the “n →”)
  ctx.textAlign = "center";
  ctx.fillStyle = "#64748b";
  const xTicks = [0, Math.round(n/2), n];
  for (const xt of xTicks) {
    const x = (xt / n) * plotW;
    ctx.beginPath(); ctx.moveTo(x, plotH); ctx.lineTo(x, plotH + 6); ctx.stroke();
    ctx.fillText(String(xt), x, plotH + 20);
  }
  // x-axis label
  ctx.fillStyle = "#0369a1";
  ctx.fillText("Trials n →", plotW/2, plotH + 34);

  // horizontal line at p
  const yP = plotH - p * plotH;
  ctx.beginPath();
  ctx.setLineDash([6, 4]);
  ctx.strokeStyle = "red";
  ctx.moveTo(0, yP); ctx.lineTo(plotW, yP); ctx.stroke();
  ctx.setLineDash([]);
  ctx.fillStyle = "red";
  ctx.textAlign = "left";
  ctx.fillText("p = " + p.toFixed(2), plotW - 70, yP - 6);

  // title for left axis
  ctx.save();
  ctx.rotate(-Math.PI/2);
  ctx.textAlign = "center";
  ctx.fillStyle = "#0369a1";
  ctx.fillText("Relative frequency  f(n)", -plotH/2, -35);
  ctx.restore();

  // === TRAJECTORIES ===
  ctx.lineWidth = 1.2;
  for (let j = 0; j < m; j++) {
    const col = `hsl(${(j / m) * 360}, 70%, 50%)`;
    ctx.beginPath(); ctx.strokeStyle = col;
    for (let i = 0; i < n; i++) {
      const x = (i / n) * plotW;
      const y = plotH - trials[j][i] * plotH;
      if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
    }
    ctx.stroke();
  }

  // === HISTOGRAM (right side) ===
  const finalVals = trials.map(t => t[t.length - 1]);
  const bins = 15, min = 0, max = 1;
  const counts = Array(bins).fill(0);
  for (const v of finalVals) {
    const idx = Math.min(bins - 1, Math.floor((v - min) / (max - min) * bins));
    counts[idx]++;
  }
  const maxCount = Math.max(...counts);

  // histogram box
  const histX = plotW + 30;             // start x after plot
  const histW = 130;                    // width for bars + axis
  const barPad = 2;

  // background panel
  ctx.fillStyle = "rgba(148,163,184,0.12)";
  ctx.fillRect(histX - 10, 0, histW + 20, plotH);

  // probability ticks alongside histogram (aligned to main y-scale)
  ctx.fillStyle = "#64748b";
  ctx.textAlign = "left";
  for (const t of yTicks) {
    const y = plotH - t * plotH;
    ctx.beginPath();
    ctx.strokeStyle = "rgba(148,163,184,0.25)";
    ctx.moveTo(histX - 10, y); ctx.lineTo(histX + histW + 10, y); ctx.stroke();
    if (t === 0 || t === 0.5 || t === 1) {
      ctx.fillText(t.toFixed(2), histX + histW + 14, y + 4);
    }
  }

  // draw bars (horizontal) with labels
  ctx.textAlign = "right";
  for (let b = 0; b < bins; b++) {
    const t0 = b / bins, t1 = (b + 1) / bins;           // prob range covered by the bin
    const yTop = plotH - t1 * plotH;
    const yBottom = plotH - t0 * plotH;
    const barH = Math.max(1, yBottom - yTop - barPad);

    const barLen = maxCount === 0 ? 0 : (counts[b] / maxCount) * (histW - 40);
    const y = yTop + barPad/2;

    // bar
    ctx.fillStyle = "rgba(14,165,233,0.85)";
    ctx.strokeStyle = "rgba(30,41,59,0.55)";
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.rect(histX, y, barLen, barH);
    ctx.fill(); ctx.stroke();

    // count label at end of bar
    ctx.fillStyle = "#0f172a";
    if (counts[b] > 0) {
      ctx.textAlign = "left";
      ctx.font = "11px system-ui";
      ctx.fillText(String(counts[b]), histX + barLen + 6, y + barH/2 + 4);
    }
  }

  // histogram axes & labels
  ctx.textAlign = "left";
  ctx.fillStyle = "#0369a1";
  ctx.font = "12px system-ui";
  ctx.fillText("Distribution of f(n) at final trial n", histX - 10, -6);

  // count axis (bottom of histogram)
  ctx.strokeStyle = "#cbd5e1";
  ctx.beginPath();
  ctx.moveTo(histX, plotH + 0.5); ctx.lineTo(histX + histW - 10, plotH + 0.5); ctx.stroke();
  const countTicks = (maxCount <= 4) ? maxCount : 4;
  ctx.fillStyle = "#64748b";
  ctx.textAlign = "center";
  for (let k = 0; k <= countTicks; k++) {
    const cVal = Math.round((k / countTicks) * maxCount);
    const x = histX + ((k / countTicks) * (histW - 10));
    ctx.beginPath(); ctx.moveTo(x, plotH); ctx.lineTo(x, plotH + 6); ctx.stroke();
    ctx.fillText(String(cVal), x, plotH + 20);
  }
  ctx.fillStyle = "#0369a1";
  ctx.fillText("trajectory count →", histX + (histW - 10)/2, plotH + 36);

  ctx.restore();
}


document.getElementById('simulateBtn').onclick=()=>{
  let p=parseFloat(document.getElementById('p').value);
  let n=parseInt(document.getElementById('n').value);
  let m=parseInt(document.getElementById('m').value);
  const trials=simulateLLN(p,n,m);
  drawLLN(trials,p);
  const finals = trials.map(t=>t[t.length-1]);
  const mean = finals.reduce((a,b)=>a+b,0)/finals.length;
  const sd = Math.sqrt(finals.map(x=>(x-mean)**2).reduce((a,b)=>a+b,0)/(m-1));
  document.getElementById('summary').innerHTML = 
    `<strong>Summary:</strong> After ${n} trials and ${m} trajectories:<br>
     Mean of f(n): ${mean.toFixed(3)}, SD: ${sd.toFixed(3)}.<br>
     The histogram on the right shows that sample frequencies concentrate near p = ${p}.`;
};

// initial render
const trials0 = simulateLLN(0.5,1000,20);
drawLLN(trials0,0.5);
</script>
</body>
</html>
