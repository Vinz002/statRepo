<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Server Security Random Walk Simulation</title>
  <meta name="description" content="Simulate server security updates vs attacker breaches. Visualize random walks, cumulative scores, and binomial convergence." />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg: #181c23;
      --surface: #181c23;
      --accent: #0ea5e9;
      --text: #e5e7eb;
      --muted: #94a3b8;
      --border: #223645;
      --radius: 14px;
      --shadow: 0 6px 32px rgba(56,189,248,0.09);
    }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: 'Inter', sans-serif;
      font-size: 16px;
    }
    .container {
      max-width: 880px;
      margin: 0 auto;
      padding: 1.5rem;
    }
    .card {
      background: var(--surface);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      margin-bottom: 2rem;
      padding: 2rem;
    }
    h1, h2, h3 {
      color: var(--accent);
      margin-top: 0;
    }
    .subtitle {
      color: var(--muted);
      font-size: 1.14em;
      margin-top: .4rem;
    }
    input, select {
      font-size: 1em;
      padding: .6em;
      margin: .2em 0;
      border: 1px solid var(--border);
      border-radius: 9px;
      background: #232730;
      color: var(--text);
    }
    label {
      font-weight: 600;
      margin-right: 1em;
    }
    button {
      font-size: 1em;
      padding: .6em 1.15em;
      border: none;
      border-radius: 9px;
      background: var(--accent);
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      margin: .5em 0;
      box-shadow: 0 2px 8px rgba(56,189,248,0.13);
      transition: background .18s;
    }
    button:hover {
      background: #0369a1;
    }
    .form-group {
      margin-bottom: 1.3em;
    }
    .chart-container {
      background: #232730;
      padding: 1.3em;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      box-shadow: 0 2px 8px rgba(56,189,248,0.045);
      margin-bottom: 2em;
    }
    .note {
      background: #223645;
      color: var(--accent);
      border-left: 4px solid var(--accent);
      padding: .7em 1em;
      border-radius: 7px;
      margin: 1em 0;
      font-size: 1.05em;
    }
    @media (max-width:600px) {
      .card, .container, .chart-container {
        padding: .75em;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Server Security: Random Walk Simulation</h1>
      <div class="subtitle">
        Simulate weekly security updates, attacker breaches, and analyze the cumulative score as a random walk.
      </div>
      <p>
        <b>Scenario:</b> A server receives weekly security updates for <b>n</b> weeks. There are <b>m</b> potential attackers, each able to breach the server with probability <b>p</b> in any week. For each week, if the server remains secure, it earns +1 point; if breached, it loses 1 point (<b>-1</b>). We simulate this <b>multiple times</b> to visualize how the server's score evolves (random walk), how many trajectories reach each final total score, and compare the histogram to the binomial distribution as <b>n</b> and <b>m</b> grow.
      </p>

      <form id="simulation-form" style="margin-bottom:2.5em;">
        <div class="form-group">
          <label for="weeks">Number of weeks (n):</label>
          <input id="weeks" type="number" min="1" max="1000" value="30" required>
        </div>
        <div class="form-group">
          <label for="attackers">Number of attackers (m):</label>
          <input id="attackers" type="number" min="1" max="100" value="5" required>
        </div>
        <div class="form-group">
          <label for="prob">Probability of breach per attacker (p):</label>
          <input id="prob" type="text" step="0.01" value="0.15">
        </div>
        <div class="form-group">
          <label for="runs">Number of simulations:</label>
          <input id="runs" type="number" min="10" max="10000" value="1000">
        </div>
        <button type="submit">Run Simulation</button>
      </form>
    </div>

    <div class="chart-container">
      <h2>Random Trajectories (Sample)</h2>
      <canvas id="trajectoryChart" height="280"></canvas>
      <div class="note">
        Each line shows a server's cumulative score trajectory over <span id="weeksLabel">30</span> weeks.
      </div>
    </div>

    <div class="chart-container">
      <h2>Final Scores Histogram</h2>
      <canvas id="scoreChart" height="290"></canvas>
      <div class="note">
        Histogram of all simulated scores after <span id="weeksLabel2">30</span> weeks.<br>
        <span style="color:#0369a1"><b>Blue bars:</b></span> simulated data<br>
        <span style="color:#0ea5e9"><b>Line:</b></span> corresponding Binomial probability <br>
        (as <b>n, m</b> grow, the histogram converges to the binomial curve).
      </div>
    </div>

    <div class="card">
      <h2>Explaining the Random Walk</h2>
      <p>
        The cumulative score of each server follows a <b>random walk</b>: each time step, the score increases (+1) if the server is not breached, or decreases (-1) if breached. With multiple simulations, we see a spread in possible outcomesâ€”some servers fare well, others poorly.
      </p>
      <p>
        The distribution of final scores after <b>n</b> weeks is analogous to a <b>binomial distribution</b>, where for each week, the server "succeeds" (is secure) with probability <span id="successProb"></span> and "fails" with probability <span id="failProb"></span>. As the number of weeks and attackers grows, the histogram of simulated outcomes converges to the binomial (and, for large n, Gaussian) shape.
      </p>
      <ul>
        <li><b>Random walk:</b> Classic stochastic process where each step is +1 or -1, sampled by server security/breach outcome.</li>
        <li><b>Binomial:</b> For n trials, outcome probabilities can be computed as <code>P(k) = C(n, k) * p^k * (1-p)^{n-k}</code>, with p being secure probability.</li>
      </ul>
    </div>
  </div>

  <script>
    // Helper binomial function
    function binom(n, k) {
      if (k < 0 || k > n) return 0;
      let coeff = 1;
      for (let i = 1; i <= k; i++) {
        coeff *= (n - i + 1) / i;
      }
      return coeff;
    }
    function binomProb(n, k, p) {
      return binom(n, k) * Math.pow(p, k) * Math.pow(1 - p, n - k);
    }

    // Simulation logic
    function simulate(n, m, p, runs) {
      let trajectories = [];
      let finalScores = [];
      let q = Math.pow(1 - p, m); // Probability NOT breached in a week
      for (let r = 0; r < runs; r++) {
        let score = 0;
        let trajectory = [0];
        for (let week = 0; week < n; week++) {
          let breached = Math.random() > q;
          score += breached ? -1 : 1;
          trajectory.push(score);
        }
        trajectories.push(trajectory);
        finalScores.push(score);
      }
      return {trajectories, finalScores, q};
    }

    let trajectoryChart, scoreChart;
    function drawTrajectories(trajectories, n) {
      const ctx = document.getElementById('trajectoryChart').getContext('2d');
      let samples = trajectories.slice(0, 18); // show at most 18
      let weekLabels = Array.from({length: samples[0].length}, (_, i) => i); // Weeks 0..n

      let datasets = samples.map(traj => ({
        label: '',
        data: traj,
        borderColor: `rgba(14,165,233,0.68)`,
        borderWidth: 2.5,
        pointRadius: 0,
        fill: false,
        tension: 0.08
      }));

      if (trajectoryChart) trajectoryChart.destroy();
      trajectoryChart = new Chart(ctx, {
        type: 'line',
        data: { 
          labels: weekLabels,
          datasets 
        },
        options: {
          animation: false,
          scales: {
            x: {title: {display: true, text: 'Week'}, ticks: {font: {size:14}, color: "#e5e7eb"}},
            y: {title: {display: true, text: 'Cumulative Score'}, ticks: {font: {size:15}, color: "#e5e7eb"} }
          },
          plugins: { legend: {display: false}, tooltip: {enabled: false} }
        }
      });
    }
    function drawScores(finalScores, n, q) {
      const ctx = document.getElementById('scoreChart').getContext('2d');
      let bins = {};
      finalScores.forEach(score => { bins[score] = (bins[score]||0) + 1; });

      let xScores = [];
      let yCounts = [];
      let minScore = Math.min(...finalScores);
      let maxScore = Math.max(...finalScores);

      for (let score = minScore; score <= maxScore; score +=2) { // Step by 2 (possible only odd or even scores!)
        xScores.push(score);
        yCounts.push(bins[score] || 0);
      }

      // Binomial theoretical line
      let pSecure = q;
      let binomialY = [];
      for (let i = 0; i < xScores.length; i++) {
        let k = (xScores[i] + n) / 2; // Number of secure weeks
        if (k >= 0 && k <= n && Number.isInteger(k)) {
          let prob = binomProb(n, k, pSecure);
          binomialY.push(prob * finalScores.length);
        } else {
          binomialY.push(0);
        }
      }

      if (scoreChart) scoreChart.destroy();
      scoreChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: xScores.map(String),
          datasets: [
            {
              type: 'bar',
              label: 'Simulation',
              data: yCounts,
              backgroundColor: 'rgba(14,165,233,0.29)',
              borderColor: 'rgba(14,165,233,0.5)',
              borderWidth: 1
            },
            {
              type: 'line',
              label: 'Binomial curve',
              data: binomialY,
              borderColor: '#0ea5e9',
              backgroundColor: 'rgba(14,165,233,.18)',
              fill: false,
              borderWidth: 3,
              pointRadius: 0
            }
          ]
        },
        options: {
          scales: {
            x: {title: {display: true, text: 'Final Score'}, ticks: {font: {size:14}, color: "#e5e7eb"}},
            y: {title: {display: true, text: 'Number of Trajectories'}, ticks: {font: {size:15}, color: "#e5e7eb"}},
          },
          plugins: { legend: {display: false}, tooltip: {} }
        }
      });
    }

    // Form interaction
    document.getElementById('simulation-form').onsubmit = function(e) {
      e.preventDefault();
      let n = parseInt(document.getElementById('weeks').value);
      let m = parseInt(document.getElementById('attackers').value);
      let pRaw = document.getElementById('prob').value.trim();
      let p = parseFloat(pRaw.replace(',', '.'));
      if (isNaN(p) || p < 0 || p > 1) {
        alert("Probability of breach must be a decimal between 0 and 1.");
        return;
      }
      let runs = parseInt(document.getElementById('runs').value);

      let sim = simulate(n, m, p, runs);

      document.getElementById('weeksLabel').innerText = n;
      document.getElementById('weeksLabel2').innerText = n;
      document.getElementById('successProb').innerText = sim.q.toFixed(3);
      document.getElementById('failProb').innerText = (1-sim.q).toFixed(3);

      drawTrajectories(sim.trajectories, n);
      drawScores(sim.finalScores, n, sim.q);
    };

    // Initial prefill
    (() => {
      let n = parseInt(document.getElementById('weeks').value);
      let m = parseInt(document.getElementById('attackers').value);
      let pRaw = document.getElementById('prob').value.trim();
      let p = parseFloat(pRaw.replace(',', '.'));
      let runs = parseInt(document.getElementById('runs').value);

      let sim = simulate(n, m, p, runs);

      document.getElementById('weeksLabel').innerText = n;
      document.getElementById('weeksLabel2').innerText = n;
      document.getElementById('successProb').innerText = sim.q.toFixed(3);
      document.getElementById('failProb').innerText = (1-sim.q).toFixed(3);

      drawTrajectories(sim.trajectories, n);
      drawScores(sim.finalScores, n, sim.q);
    })();
  </script>
</body>
</html>
